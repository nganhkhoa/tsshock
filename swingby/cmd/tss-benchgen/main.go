package main

import (
	"crypto/ecdsa"
	"encoding/hex"
	"encoding/json"
	"flag"
	"fmt"
	"math"
	"math/rand"
	"os"
	"runtime"
	"sync/atomic"
	"time"

	"github.com/binance-chain/tss-lib/common"
	"github.com/binance-chain/tss-lib/ecdsa/keygen"
	"github.com/binance-chain/tss-lib/test"
	"github.com/binance-chain/tss-lib/tss"
	"github.com/ipfs/go-log"
	"github.com/pkg/errors"
	"golang.org/x/text/language"
	"golang.org/x/text/message"
)

const libLogLevel = "error"

var (
	expectedIncomingMsgs,
	receivedIncomingMsgs,
	nMinus1 float64
	preParamTestData keygen.LocalPreParams
)

func init() {
	preDataJSON, _ := hex.DecodeString(preParamDataHex)
	if err := json.Unmarshal(preDataJSON, &preParamTestData); err != nil {
		panic(err)
	}
}

func usage() {
	if _, err := fmt.Fprintf(os.Stderr, "usage: tss-benchgen [-flag=value, ...] datadir\n"); err != nil {
		panic(err)
	}
	flag.PrintDefaults()
	os.Exit(2)
}

func main() {
	prt := message.NewPrinter(language.English)
	var (
		quorum     = flag.Int("q", 3, "the signing quorum (t+1)")
		parties    = flag.Int("n", 8, "the number of party shares to generate (n)")
		msgLatency = flag.Int("l", 50, "the target network latency (simulated) per message in milliseconds (default: 50)")
		procs      = flag.Int("procs", runtime.NumCPU(), "the number of max go procs (threads) to use")
	)
	flag.Usage = usage
	if flag.Parse(); !flag.Parsed() {
		usage()
		os.Exit(1)
	}
	if *parties <= 0 || *quorum <= 1 || *parties < *quorum {
		fmt.Println("Error: n must be greater than 0, q must be greater than 1, q cannot be less than n.")
		os.Exit(1)
	}
	if flag.NArg() < 1 {
		usage()
		os.Exit(1)
	}
	dir := flag.Args()[0]
	if _, err := os.Stat(dir); !os.IsNotExist(err) {
		fmt.Printf("Error: `%s` already exists, delete it first and this tool will create it.\n", dir)
		os.Exit(1)
	}
	if err := os.Mkdir(dir, os.ModePerm); err != nil {
		panic(err)
	}

	fmt.Println("ECDSA/GG20 Benchmark Tool - KeyGen")
	fmt.Println("----------------------------------")
	fmt.Printf("Max go procs (threads): %d\n", *procs)
	fmt.Printf("Generating %d shares, quorum=%d...\n", *parties, *quorum)
	if *msgLatency == 0 {
		fmt.Println("No network latency.")
	} else {
		fmt.Println("Network latency per message:", *msgLatency, "ms.")
	}
	fmt.Println("----------------------------------")

	runtime.GOMAXPROCS(*procs)
	start := time.Now()
	runKeyGen(dir, (*quorum)-1, *parties, *msgLatency)
	elapsed := time.Since(start)

	fmt.Printf("Done. %d shares written to `%s`.\n", *parties, dir)
	_, _ = prt.Printf("Finished in %d ms.\n", elapsed.Milliseconds())
	os.Exit(0)
}

func setUp(level string) {
	if err := log.SetLogLevel("tss-lib", level); err != nil {
		panic(err)
	}
}

func setUpProgress(n int) {
	nMinus1 = float64(n) - 1
	expectedIncomingMsgs = (3 * nMinus1) + nMinus1
	receivedIncomingMsgs = -1
}

func incrementAndDisplayProgress() {
	var progress float64
	receivedIncomingMsgs++
	if receivedIncomingMsgs > 0 {
		progress = math.Min(1, receivedIncomingMsgs/expectedIncomingMsgs)
	} else {
		progress = 0
	}
	fmt.Printf("\rProgress: %d%%... ", int(progress*100))
}

func runKeyGen(dir string, t, n, msgLatency int) {
	setUp(libLogLevel)
	setUpProgress(n)

	fmt.Printf("Starting... ")
	minMsgLatency, maxMsgLatency := msgLatency/2, 3*(msgLatency)/2

	pIDs := tss.GenerateTestPartyIDs(n)

	p2pCtx := tss.NewPeerContext(pIDs)
	parties := make([]*keygen.LocalParty, 0, len(pIDs))

	errCh := make(chan *tss.Error, len(pIDs))
	outCh := make(chan tss.Message, len(pIDs))
	endCh := make(chan keygen.LocalPartySaveData, len(pIDs))

	updater := test.SharedPartyUpdater

	// init the parties
	for i := 0; i < len(pIDs); i++ {
		params := tss.NewParameters(tss.EC(), p2pCtx, pIDs[i], len(pIDs), t)
		params.UNSAFE_setKGIgnoreH1H2Dupes(true)
		P := keygen.NewLocalParty(params, outCh, endCh, preParamTestData).(*keygen.LocalParty)
		parties = append(parties, P)
		go func(P *keygen.LocalParty) {
			if err := P.Start(); err != nil {
				errCh <- err
			}
		}(P)
	}

	// PHASE: keygen
	var ended int32
outer:
	for {
		select {
		case err := <-errCh:
			common.Logger.Errorf("Error: %s", err)
			panic(err)

		case msg := <-outCh:
			dest := msg.GetTo()
			if msgLatency > 0 {
				delay(minMsgLatency, maxMsgLatency)
			}
			if dest == nil { // broadcast!
				for _, P := range parties {
					if P.PartyID().Index == msg.GetFrom().Index {
						continue
					}
					go updater(P, msg, errCh)
				}
			} else { // point-to-point!
				if dest[0].Index == msg.GetFrom().Index {
					panic(fmt.Errorf("party %d tried to send a message to itself (%d)", dest[0].Index, msg.GetFrom().Index))
				}
				go updater(parties[dest[0].Index], msg, errCh)
			}
			incrementAndDisplayProgress()

		case save := <-endCh:
			// SAVE a test fixture file for this P (if it doesn't already exist)
			// .. here comes a workaround to recover this party's index (it was removed from save data)
			index, err := save.OriginalIndex()
			if err != nil {
				panic(err)
			}
			tryWriteKeyGenDataFile(dir, index, save)

			atomic.AddInt32(&ended, 1)
			if atomic.LoadInt32(&ended) == int32(len(pIDs)) {
				// build ecdsa key pair
				pkX, pkY := save.ECDSAPub.X(), save.ECDSAPub.Y()
				pk := ecdsa.PublicKey{
					Curve: tss.EC(),
					X:     pkX,
					Y:     pkY,
				}
				sk := ecdsa.PrivateKey{
					PublicKey: pk,
				}
				// test pub key, should be on curve and match pkX, pkY
				if !sk.IsOnCurve(pkX, pkY) {
					panic("public key must be on curve, but it was not")
				}
				break outer
			}
		}
	}
}

func delay(minD, maxD int) {
	time.Sleep(time.Duration(rand.Intn(maxD-minD)+minD) * time.Millisecond)
}

func tryWriteKeyGenDataFile(dir string, index int, data keygen.LocalPartySaveData) {
	fixtureFileName := makeKeyGenDataFilePath(dir, index)

	// fixture file does not already exist?
	// if it does, we won't re-create it here
	fi, err := os.Stat(fixtureFileName)
	if !(err == nil && fi != nil && !fi.IsDir()) {
		fd, err := os.OpenFile(fixtureFileName, os.O_WRONLY|os.O_CREATE|os.O_TRUNC, 0o600)
		if err != nil {
			panic(errors.Wrapf(err, "unable to open fixture file %s for writing", fixtureFileName))
		}
		bz, err := json.Marshal(&data)
		if err != nil {
			panic(errors.Wrapf(err, "unable to marshal save data for fixture file %s", fixtureFileName))
		}
		_, err = fd.Write(bz)
		if err != nil {
			panic(errors.Wrapf(err, "unable to write to fixture file %s", fixtureFileName))
		}
		common.Logger.Debugf("Saved a test fixture file for party %d: %s\n", index, fixtureFileName)
	} else {
		fmt.Printf("\nFixture file already exists for party %d; not re-creating: %s\n", index, fixtureFileName)
	}
	//
}

func makeKeyGenDataFilePath(dir string, partyIndex int) string {
	return fmt.Sprintf("%s/keygen_data_%d.json", dir, partyIndex)
}

// ----- //

const (
	// taken from line 1 of `test_data/preParam_test.data` in this repo
	preParamDataHex = "7b225061696c6c696572534b223a7b224e223a32323830313335303038373335383239343837343731333037383830303937313936373735393038313734393130333436323333363436333932383533323836363035393632353632373932383235373332343337313331333538383632343532343835363233353333333331303934383933363931393438373337373435383732363838323639383030363233383633393135323331383530363737363730333938313838383336313839303538393033323732323639303436363331343437303238333439313633393035373237393231323439343835313638323632323437373333313433343634343335363337353237333133333639313432393230373038303035333436363236323633373336333735383635343733353339333939343830323136343738343639323235383239363831363837333332333934363031313835393631373336303035363932303137313039393436343335373532383338353434303231323533363933353135383330363639313532373236393437363631343233313835343839303332323737303833313336333932363330393035313435393635323533353031373133353938313837393331313136323837333237313237363731313038353434353732353134303639303133333434323639373135393938393436333139353030363731303838343839303634303330373232363533303536333031383534303236343233303832363238313033353232383332353039343333333631343733373130383236383034363933393035313037393931343739333931363533303433313731333436313432393135353931333439393132373439372c224c616d6264614e223a31313430303637353034333637393134373433373335363533393430303438353938333837393534303837343535313733313136383233313936343236363433333032393831323831333936343132383636323138353635363739343331323236323432383131373636363635353437343436383435393734333638383732393336333434313334393030333131393331393537363135393235333338383335313939303934343138303934353239343531363336313334353233333135373233353134313734353831393532383633393630363234373432353834313331313233383636353731373332323137383138373633363536363834353731343630333534303032363733333133313331383638313837393332373336373639363939373430313038323339323334363132393134383235363833303434323234363539393531383030333536353633373034353639313931393238313237393337353834333037323532363336353034343931353435303039303235363238393237303236363338373733383534373630373231343535313439363132313730313437343231373539313730383432353739333437303932303138343037313037373333363636313337373933333230343937333437333732313832343236333937313234383335373939393137353732343537373032323038303335303332373331383131363135373936303534383933303639333831373838363935373239303538393533343131393139373734353038373236383036353437373031363437333330343136383632353232343630343130303431393135313339323833383930333733303035382c225068694e223a32323830313335303038373335383239343837343731333037383830303937313936373735393038313734393130333436323333363436333932383533323836363035393632353632373932383235373332343337313331333538383632343532343835363233353333333331303934383933363931393438373337373435383732363838323639383030363233383633393135323331383530363737363730333938313838383336313839303538393033323732323639303436363331343437303238333439313633393035373237393231323439343835313638323632323437373333313433343634343335363337353237333133333639313432393230373038303035333436363236323633373336333735383635343733353339333939343830323136343738343639323235383239363531333636303838343439333139393033363030373133313237343039313338333833383536323535383735313638363134353035323733303038393833303930303138303531323537383534303533323737353437373039353231343432393130323939323234333430323934383433353138333431363835313538363934313834303336383134323135343637333332323735353836363430393934363934373434333634383532373934323439363731353939383335313434393135343034343136303730303635343633363233323331353932313039373836313338373633353737333931343538313137393036383233383339353439303137343533363133303935343033323934363630383333373235303434393230383230303833383330323738353637373830373436303131367d2c22417574684563647361507269766174654b6579223a7b225075626c69634b6579223a7b2258223a3130393830323038353631323631313933363133343632343537303835393731363336313630383235333235323838383131343838303939373239333839393230363336383332303632323131342c2259223a34393535373132383735383536383235363831333139383434323832363436373834383836323239333037393339373032383937323334373037383335393932323234303639363731363338347d2c2244223a38343436363338303534313939303736323731313334313035313539303233343831383832363432353833353439353632313632363738343437323437333032373334313930353835393239397d2c224e54696c646569223a32313634383833313838343331393735363738363837393036323230353832343434363439363336393238383035373930333733393139373833333939373630373434393634323830383233303039393137333135323933343831313332353739363731303835303833373232353130363432343936363737363731353531303332313038313833363431353037363538393733363630383832323333383339383536313830383731393339363334353732383733353338393933363036333537353538303936353530323631313639313030333630373732343133323133323936333934343538393331373932313332313737333232363939303739333631393231303934383836333139313136303036333032333539373337303738363938353235343331303730353534343139303636333830373837333037383033353136313633363830333136393230333835313339393333323830393630363938383131373439333430303539343630343437373039373435323532393939323231323232373336353234383835313436333436313736313934303237313836393031373137303734333935343433323235343636313239383336383632333737393137383539353531313935363733333336333737383032323339383433303139363432303532323135373134303336303434353237343131383238393934393733383939343731393332363935363737343936363130383634353234383532373335343831383633303636393338333237313337313338373730393536303638323638373434353035363531373137303633333531393635373232333635363839303031393639372c22483169223a31373133383833333932313537313232313031363438363232363531323234343438323338393331353434383038373934393835313139323036333038393039373930333138313534353439353532393031363833393638343739393030373232313432373035373738303931393732323139353639393830343835323733393630383733383736303134393939333738333538313435343233363337353838373733383336303932393232323135343034373034373439373532393138323431303030343530393835353133303931313933333037353238393732363130323536353331363835383133323136353731353830313039383730373233373531323834323637323936323634303133303239303631383432353839303733333837323938303936343232323537383035323936343836303834383730373539313339343031333637393231343736343934373933323133363334323535393235333835353632303438353739323736383434313835323931323830323436313436313230383034303034383432303035303430353232323330393033393136363636323737353031393836343936353335303132343838303130353234313130353931373235343336313436393635333739343034393935353634343132323831393230363836313736303535343632343139313938373434373034393033353335333230393531333537353330333437393130323934363238383734333537393833303831393934303135303831373533363132393634353832383032353235383335373031333334333335373638383638353631313032303833383033383338303933303439302c22483269223a383238333130323530383536303238373039343236343039383132363535333838363530383730373532363430383030353237353936353039383637343632323131383933373939343737353431363737363333393833333837323233383434393535373337373038383436373937323733333039353330303836373839363338343830303731323236373132373035323030353231303334383835323736393134393433373237343237393038393131353337323637373036373635343938343233363732373635303836353533363230383535343035303939303839313533333630313931303335383136333736333237373234393833313837333132363237393933393336373036363232303037323137363231323436393435353233383935383838373439353930333534303432393236343238373932313534313135383930373832393931303039343937333535383833353931383330383533383137343935353632323736383033393638333737343433353531373131333039343038393938393731303430363338333638383535333132303133353538343236363938353630343439333035323932303531393532363737363233373432303633363039393236373233393439333232313835393733383231373936393230363638313434343337303737333933333633363935303938353136313834343833363132383536323734363833353236363837373531373538363334333736373339373838313033323134313734383631303839333235363836373330393533353235313231333931393534313532353535353038363937363333383030373331333232353634362c22416c706861223a32313137313837323837313937313034303639393939393639393135353232333238363930343033363438313031303933333335363131303436363533323930313636353631323730383133393930393137363035333430333430383931383530393533313239343438383630323030363133353634393434393535393039353433373938373637343530363537353635393239363034353330393539303731373438383734383839383639303833313438393133323637363933343034303833383936383034373936383638353731383834383039353432373637343830393532383334323538363235313234303239383439303735383730393834353931323838373337353739383935313337343530383130303732373638393233323737393635353634363233323238333736333337323836353338333932353830313130313235383635393534373737313230343731303939363730353333383038393436383031383636333234343434343530353635313439383733363735373731373830323337333635323133393335313234373833353933343235373531373931353136343232313132393931373034373436313132353637333933313635393536333232303936373836373633313431313438333537343933313039323430343337333136373237353538383730393432373539343632323135313339303135323834363330303234333030383939313730313737353131333435383636323733323737323232343735383836323430393731353439383535343439383734363335313034313537313736303438313130373232363038313231313235303737373934313231362c2242657461223a333332343232323038343230343937373431303033343331363637393538303937323730313534373831363531373832323537363732303838393831333337303135363739383739323738363233303033323035323831313036383834353131343535353934363231373232343331383435323032363933363231353735383430343035383334383834363630363538313738363931333337333736333933333731343932323830393736363636313931343137323031383832333230303231373737313133363139323238303837323837373930353732363130313539363633303636333934363534333236393639373337313236373639353834313632313735343434323034353837353732393233373230383934353838333533383338313539303932353433353031313335313233363839333439373938313538323736363238363533343534373937333032353932303330353536303130303439313534353737353939303937393237303535323036343139303231393436393231313432313531373735323936323435373732323633373939353133303737393336383336303033343537303438323836373133363131303738393135333932313830393639343033393335393735393730303636303438363930343239383934393638353837333539373836363430393938303937333438373835343732363336343835333739343239313531313839393537373639353236303937393237343131393336333634363631343438383431333036373832353337393732313635363136303034383531363435323932313834383631363835313330323032313530353635343736312c2250223a37343639313032323533383230303035353130363338383032353436373834333730303238363438333533393832333137333637393231303833353438393739333037383239303739363230373735313930383533313932383639343136393634363739333032333538373432303335313137353232303830323430353735303534353636343735323731383335343032373137303034363839303231333031383030373936393733363536343232353736313132393534383036383234393830323037303939353430393231313636313133303939313231333733303633373832313333393730333736313837343732363038333032313937383430363935333534363836373831383836393233333536363835303639323330303836373834383233353838323534333835363538393234392c2251223a37323436313239313639343231383138383831383038313530313136353738383339373434363035393736353834333233393435393935393537313039353236383934363631393733373439363133303238303135383430333630333633343037363834353032353032323231323438353036363037333633373239323735333436353736383937383836383734333334383533363234363730343139313532333538303239323137323139373031303938323031303334393932313634363735353236343135393532313434393434383538363438313833383039323033333935373231303034303236343430323334333632303835313935383131383639323439383939343333303733323238333336383839313039373138313933323036313437383136333839313838343930373930312c225869223a35353138323132333030313332343139343437323532373333343630393037383031353632333637373832373331343238333635313533393231383632333236393538343430353537343739382c2253686172654944223a35393935343438373239373838353331353931333439393233313334393337343335353630363739353131303832313435303732393735323331313933353435393937323136313438313730372c224b73223a5b35393935343438373239373838353331353931333439393233313334393337343335353630363739353131303832313435303732393735323331313933353435393937323136313438313730372c35393935343438373239373838353331353931333439393233313334393337343335353630363739353131303832313435303732393735323331313933353435393937323136313438313730382c35393935343438373239373838353331353931333439393233313334393337343335353630363739353131303832313435303732393735323331313933353435393937323136313438313730392c35393935343438373239373838353331353931333439393233313334393337343335353630363739353131303832313435303732393735323331313933353435393937323136313438313731302c35393935343438373239373838353331353931333439393233313334393337343335353630363739353131303832313435303732393735323331313933353435393937323136313438313731312c35393935343438373239373838353331353931333439393233313334393337343335353630363739353131303832313435303732393735323331313933353435393937323136313438313731325d2c224e54696c64656a223a5b32313634383833313838343331393735363738363837393036323230353832343434363439363336393238383035373930333733393139373833333939373630373434393634323830383233303039393137333135323933343831313332353739363731303835303833373232353130363432343936363737363731353531303332313038313833363431353037363538393733363630383832323333383339383536313830383731393339363334353732383733353338393933363036333537353538303936353530323631313639313030333630373732343133323133323936333934343538393331373932313332313737333232363939303739333631393231303934383836333139313136303036333032333539373337303738363938353235343331303730353534343139303636333830373837333037383033353136313633363830333136393230333835313339393333323830393630363938383131373439333430303539343630343437373039373435323532393939323231323232373336353234383835313436333436313736313934303237313836393031373137303734333935343433323235343636313239383336383632333737393137383539353531313935363733333336333737383032323339383433303139363432303532323135373134303336303434353237343131383238393934393733383939343731393332363935363737343936363130383634353234383532373335343831383633303636393338333237313337313338373730393536303638323638373434353035363531373137303633333531393635373232333635363839303031393639372c32353835353432363634313334353032393139373137373236373138313738313236393937343138333635353030323938383931353935373631303635313739373330313736363435343537393634353336343233383239333431303237363533343734353739383338313032343132383138333039303930313534313832313534363132303130333032303136353938343233333032363430383732303136353938393938333538363430393033363138383234393435373138363637303931333331313135313130313234373434333932343237323932353935383330313639373635383734393635323238313437353530343637343835323030353136333930313838353832343637383334373035353035313638393535393132303230383331353430383434343031383634383235393531343435343334353538373531393635333239333831383331363736323633393237373933313836313237373638323736363832363134353036363036303735333336383538393530363230373834353934383735393335333231353937363630343139323534383438333937363737373139373733363430343131373936363030323236393034363732393437313831303137353830363533373239323533373237393131383139323431303637353733343635343537393339343331343735303230353736393434313139333033353038343430393238303534323235333336303837333237343335353132353030363238393432323831393235383339383939373037363230343434313139373031363630393432383333383535343230343337393432373837363530383032333938392c32393035343830323934303337373934353930343036373034383133333037363035363936313935363939333530363634333237353737343138313835323739363036363731393531333032333333353532333931393735303130303930363034363231343633353435393034343937353937393137303334393336343139383135303034323438333431303635383933333737363431333232383336363539353237353631343731383539373535373233393130383232333136333338363938393039323035333938333336373135303730393439363031363735323139353737333532353739323233303239323531393136323432373039323536383937393533363835333331353134363039353331343933303438373836343236333737383836323633333331313332343932313539383032323833383039323838303936393632383530303731313136363636323231333134343832333637363639373831313634303838353935323231333338303935343934393138383137323437303138323930353931373238393031333736303931353533353138313135383535363935363034313035333733363632303131333537333135353131363830373437313730323632333238353433343539383439303539313439383331353436343532333733373835303335383833323339383837363531343434303439363734373132363338383539303232393431383736393230343533313932333835353632353636393434353735313937353839323737333632393331353439323831323233353836393231343632373939373037363736333537323432353639373030313838373138392c32383936313034373632373839313431323532313734373531363534363934323533333430353931303937333930363339313936343536363335313230373739363733343136313235393939393238333230353735323432323431323735363238353838383237343830323333383937373930383438353239363037343938343331313331333036393737393732393331393734303337313239333838383531333330353738393138373938373837383832383034353037383039373636353235323832393834323631393931313837393634363433333832353636313035303639383835393135393135313033333939353434353738343132363034383134363331333731393830393731363039363833333539313530323132323537353735313333303133303132343536373732303730303030363339303630393139313539353539373237383139333339363338363038333432363432313337343335383938363234333333383234373535343930343836323231303535303832393836393234323937353934303933383933363831313238383836373730383438333335343236373237323937383638363639383837343533323731363335343735393539333737313639313432383934383135323939373331383635353338303435323530313134323330343236383839363233343736313534373232363836353636313337373633323233393230383336313933363232333535373539323931373437363035313031333335353038313735393339313230363738373437343931383335313535313735343232333739383230313132373231313533303833313131393135333931372c32363133323539393435323238363733343034363434343130323537373636323534353630343039393632373535313031313630353336353431333839323433393031303637373137333738343337393539373032323632313632383636353735363333343836353034383839343432383038333035353432333936373037323931393838353731373834383030313739353230333930343932303036393036333939353833363035373137363738353539393037303138323839383036313131343936393032373438303334373139343331353736303136393932333835313936313230393534313032363837393330353635333936393939313436383733343839393833373530313233393438333335363836393230313039353834333735333934383532353431313535343433383833353435323735353335393238353134313530333438333433373134373337353239333934363531343538323234313439323633313531323732313435343939363736313835373131373130313333353335373937343737373736313839353632383536353037333835313632393435323138363239333637313038373432303434303931343432333136343135353130373433353831383539393031313133373335323635343736383232383131323037333837333137363932343435323235363230383736313536393638373538303435353534373139333134363136333732323138333736373832313032373732373637343034303039333139323636373435383438323338363937363536343434383331363431353532353835333833353235383130363233323330383338303732313532392c32323830303730393439323738333830313036363434363132313932323734323335353834313634353532343238333237383131373135333031333535393930333831373733303635313732303436343934383435333233383139353236363532313438363337353438323137353037393536313933323439313134343934393136333833303231393434363739343830383332333130333631313834333136303231343638313532303034303039353734353638323332373532333436333033353039333032363639313932363734393235373934373634353534373033313030313932333237383436343834383336393735393034383333393738333035353434313433313137313034393031303339333236303539323338393937383838363539393638363136323432393736363138383134393538383337333031363633303435393431303832323534363430363936343337393433353036303235333035323931333937333734333938303931373636373431303534323935303834363832333430373235393532303431313039303938393832353437353932303037393938373033323133393339303834313531383430353939393439323735333132353435373931363535343634303334353935333730343830393032343536313231303137363532323938323937393132313533363637323830373833333131313239393436343938363730323634373133343839343532333130303131323734333837323531323536353236333538383937323830323837343932343436343832303937383033323936363430393133393434383939313139373031333530343537353730395d2c2248316a223a5b31373133383833333932313537313232313031363438363232363531323234343438323338393331353434383038373934393835313139323036333038393039373930333138313534353439353532393031363833393638343739393030373232313432373035373738303931393732323139353639393830343835323733393630383733383736303134393939333738333538313435343233363337353838373733383336303932393232323135343034373034373439373532393138323431303030343530393835353133303931313933333037353238393732363130323536353331363835383133323136353731353830313039383730373233373531323834323637323936323634303133303239303631383432353839303733333837323938303936343232323537383035323936343836303834383730373539313339343031333637393231343736343934373933323133363334323535393235333835353632303438353739323736383434313835323931323830323436313436313230383034303034383432303035303430353232323330393033393136363636323737353031393836343936353335303132343838303130353234313130353931373235343336313436393635333739343034393935353634343132323831393230363836313736303535343632343139313938373434373034393033353335333230393531333537353330333437393130323934363238383734333537393833303831393934303135303831373533363132393634353832383032353235383335373031333334333335373638383638353631313032303833383033383338303933303439302c31353338323031343338333333373839323431313830323432303633313039373733303736323239323030383038383930393631303431393030363833303833393932383230353136353239343338393130373737303531313536343334303732353836393434393034343736363732363135303538343935383737303931373732303237363238353234303732323039343330343338303537313530343631313635363838373937303230333539323836323831323931393532343534313638303233393339323537383739323031343339393138353936373132303235313930383533353532353933353334323934323635393338373732383430303733393039383337363837343036353231313634363635393435333830363939303035353932393131303836373536373036393731353831313734343535303738353332373738393837333535333236333338373636313636373439383539313236393830343135363632333339353539313935363433373835373733383435333934383335353033363038353037323436363838353439303330313133353734313937343532393736383339383836323936373230383033343336333430383333323738383635323930383138343034303634363235303732373632363139323832303033343635303130373434323732373938313535373434313335373935373836333938393135333438393036333738373936393930353738313739333236373238383631323738383431383933333637363531383631373333323837333334363838313438333539343937373330393736373137343438393237373538343831303632343334352c32333337343736333337393633313638303131333731313732303135373630353639303032373038313338353134353930323831353438323832343733333733383937363330343733363537343431333631303935303036333436393938353236393233303936343438303935313335373631383531343231363838343234353332363537393635353639393030323834383237323833393930393834343430393439303330343230303530363139393232333137303230313834333835353631333935393134303933363938333035353633373934313137383635323730333930323838323035383734303530313638333939363038303738323539343434313430393339333837303530313336363331393637313637393235363531353932333532373336383633373031393330343133323633333434393032323736353839373235383834303339313635313135343939343338303933323232343133313531353735313033323232363139383930323737353037393637323436343437313232343237363031303534333339323238373638333637313331313836313234303038333830393433393531383936343232303638383334323638353735363536393235323135393934353033373239393033323834323635363335353433303232373230313231343833313133313837343836363232323535383530343032343733373535393931383739393734363134383936383339353136363335303832383836383138343436393534373736313532393639313932383439313130303033353833393230333438313135363234393133343731343738323530383434393735393835332c32373339393932393432333436303330323838383934393134333834353335393834393632303632373733333930353036383339313930383039393637323333393138313137343033323530313435383232363036383837383735353435353835303138333530383930393933333838393537373130383231303630373833353635393536353030373235393635343433323432383733353639393635363338303237373435303138343434313839333935323033393837383734353436393037373630393533353432333438373031343032383935373738353330363937373531313431303533303431363839333436323730313137333033353639343030313230323739373830363334343535303037363930373739383234313235363934333937343533373536353938343633353331323735353030373936343539393338333238303236353030393832393835353737393838393037393130373232393231333437313735343039323136383238383330303333343838353539313935343938383633343738303233363230343231333034353430303139353031323238333539373631313631323930323939303737373238373034303431393230343438343830343231313231373033363735353938333436343933353131383038343232363732343632313035343235353537353937363837353833323034333438393638363933363930393635363530383331373931373631333332313635373031303833303632393332323438363538363838353537303538333736353830363536343330343235323735353232303537303636303830383133373837323932353438363135382c31373834393938363739393036383531383034303232333131353937333033343830323339393336363934393530363933383632363934363939373833323131393833323532303434393833353738383337363932373933303732383737373637343737303739313039343435383334373935383831303833373733323435313238313530393135353431383739313130303735363630383632373939323934373233363330393639303334303336393531333935373132373437343730303734373634313139343631373930333431353938383531343437393235303735353634343333323231333732363136393830323131333538323930383339373636383338353235353438323233343736373736323830333137343833383630373837393436363932343436323930373332353036343434383239353433303536303836353337323435303237383938323633343232333336373332313138343933393634393837383437323234353230393833393133393334343133303630393434353332393734393238323330333430363630363537363031333734353836373330393431313231383631383233303637313037313737313037323236393237393336303531363631343631333635383434373031333731343732343838383435363633393937343430363132343830303233373733343135393233393334303036303839383632343138383334353437353935323235323435313336373136383331393431303933313336303532383535363336343535303035353336383639343039373337363236383539353034393939393532393830313533383839303332303933383031362c31323731343631353230393736343833363230303631303233363735333939313339343536313136323835363030363438303939353132373637333137303838373238303937313130323530303834363330313436313734313838333534393236343433303236323533303731313538363432383836363332353034313339373839313437343730323738393531333836333231373333383936363332323639393435363634393630343938343935313839323630363731313838363539323535343339343331303436353135303732393934303339333534333034393630363239303738333033303436313631333037353030303836303935313237303932313331333339373531353037363431343930393036373631353035393136373234373230373530333238373836363737383232353539383939393237323036373637393030323339343436343036353739323038313735383330343532313834363437323238393734363935303138383231373534323632363130343937313633323637353938333436303032303136303134303938383534353136333034313634373133313635323537373036343932333433353333373035393439313434363438333533353030353736313333313831313030303231303132373438303535383238343936353333313334363530393535333032333132333132313737373731323831333235393636383339353032333833343232363231363733333033373338303434393931343639333036303635343734393936393333393836353832353630353237333430383938313837323433373735333536323636373437383933353738323634305d2c2248326a223a5b383238333130323530383536303238373039343236343039383132363535333838363530383730373532363430383030353237353936353039383637343632323131383933373939343737353431363737363333393833333837323233383434393535373337373038383436373937323733333039353330303836373839363338343830303731323236373132373035323030353231303334383835323736393134393433373237343237393038393131353337323637373036373635343938343233363732373635303836353533363230383535343035303939303839313533333630313931303335383136333736333237373234393833313837333132363237393933393336373036363232303037323137363231323436393435353233383935383838373439353930333534303432393236343238373932313534313135383930373832393931303039343937333535383833353931383330383533383137343935353632323736383033393638333737343433353531373131333039343038393938393731303430363338333638383535333132303133353538343236363938353630343439333035323932303531393532363737363233373432303633363039393236373233393439333232313835393733383231373936393230363638313434343337303737333933333633363935303938353136313834343833363132383536323734363833353236363837373531373538363334333736373339373838313033323134313734383631303839333235363836373330393533353235313231333931393534313532353535353038363937363333383030373331333232353634362c333335363533393239373332333530373430363831383130313030373132303436363338333530363431353336353930383134383639303134393234373430323931333333323233353739373634383433303433303235353032343837343737303733363934313631313636373837313332393832323631343438323739373738363538383435373132353535383637333935373934383831393637343130303230383337313735373538333733363637363832383131313439373031373633343334333837323430383135303939393539303133373431303039323336383436383833373430333532333035383432303037393039323730363936373734383133333030373039323435383736343333343139353331333134393731313639313238323837313139333131393034303338383039393633363439303636393331383330373333323232303031383830393031383230303734393535303831383431303036363131353134343334363532343434313231303133303035343834303432363734303836333235333032343632363433373035393834323434323138303937313832353835373538343031313235343437323039353939373930343539343735343231393034383039333435383530323230383433383235383338383934323332313137323136383834343438383730363330363235393233393935363535363833323834353435393030393234333336363135343235353835373930383434333037313734373037313034353735323132343034383932373330363936343136353331303035363139373731353231333035303334393636363433383632343731302c32343733353030313731393430393433353138383332313833333039313638343332383238393934343839383936303532333631323033303832323935393237343939383535363339303439363931353635323433363636303236353932313837353336383534343139303832393530303635313331333733323432393733383438353739393634393630333439343536303639313331363636373635393235373730373733363037313631363931383034353137353230383739393238313531323935393137333430393534373538393735363237393038303039323830373134313135353631343131313631353438393035313537383234303932313037373633313536353437313732323930373736303633393432343330393437363031373838393130353132303332303432313338363430363430333130303631343637353537383334363132303238363732303135353634383034343533343233313730363639313538393133333537393633313837353937383231353733373039383630393037393836323333393934363131303036373536353031363835323239393236333533353035373437353733393630363839343130393234393435363038313336363937343230303030393831343237383338313134353331333334343538363833363433353438393137373734373339323338313135313239373734323630313230303438353834373631373238353034383635313532303436353836383238383338333636383230343035383331343035383032313632383739383639383433383735373530343933313730333535383735363732323734383039363035323435332c333639323432363636393132323738323135303333373039313137323330333531343632313936303238383036393330353735303834303436363337373633323531343634303535383638333437373333343034393638353336333631363132383939393935303535303730313537313131323233333735323931373438323734353737353736343436363630323133333639333932303233363833343336373139363035343634393034373939333234333233313438383235323931373733373331333632393535303137373535303533393832393435323935323936313234383337383831393136333635343232323036303730303332373632363532343333353934383632383239383537373036323534353935383739353136303731383630393331393437343436373236393838313036393731353933343735323531393338313730303330353238323932313432313937373030353238313531393332383638313638333532333137333836313636333532393737393336353232313138383133373631333237333335303431313331303332343932313033303837363139333738313932313433363434353532343130373932373038383331333037353534393736373439363230323833353132393936353039383734383236363932343530343838303238383830353537303335323730323432373433313138323931373731383838333137373035333535353735333632383831313834333234393536303832363739303331353331303032373637393038383633363138383230353536373239313931333530333534393836373030303833313535323637353933383839352c32303036353539313630303839373234343932303538333938373431323235353134343133303833353633363337333432373939343433313035393433303730323838383034353439323131353734343238393634343837373238323033363435363737313638383930373434363135373239313835353035323434313236373639383235333137353030373235323130393330343736353134343336313435383639343138353833323333323535383238313735303131383832353738373638303630363331303237303937383233313930373635333039383230393238393635363433323830383133323835303737393231313838313630383639303030343738343735353330303638383038363933383131313437313232343031313837323830363930333937363832323236343430363632313235303131313437373930353938363830393837383531363235363634393832343032393634303839303436363237363430323538363337343032303930373036353739333134383236363732383632353636363039363332323734303336303138363839373730383038393838333931363937333634373439353835383930373432393130303239393036343331373539363439303530383937353935373237333633383939323339323433323936303534353834383836353831393637393138353634313131383239363038383933343139333031363331333431343432313230313037323131313738313536383237383937363237383035383631353136353238343535383730343839333831343535393434363033383833303636323633303334363033353835303136333033302c31363238353539383831303534343633343934353436393434343130363938383436363831313034383230303135303830363034333334383136353236353432323633373737353735373935303830303039393939323035353639353436363532323534383033303230303439303238343730373430373135303933313331393934353034343333323737393134363439383531383539363537353430333534393739333539363736333030313032313939303131373931313238343734323936363131393533393737313039343234373336353935313030363732363838353231363330303137383437383137313831353936353031313130393134313138383933383934343238303836373936393436343632323730333235363739343733343932303637303330323532363730343836363539313436363131363332313236323331313632363333323235343839393137373332393139373334373937333831383735313230373930383030333731373435343333363830313130343731333332323331353632313434383637343236363633363337393231303237393134323131383935373335333037323438373731313239383939323831313333343431363038313332303035363036343831383030353636313430363133323839353137313834363130383138343531383036373135353232363034313636303233353438383638393538303037373439313432363530393030383935343437373134373833303834393034363332383334353935343134373838373638363335313034383033353531393134313033343634313438343530363437353134343038383630343533375d2c22426967586a223a5b7b22436f6f726473223a5b38393138373933353431313834393835353031353733383139343230323239333835393934373338323439393835353337363833333234363031373637373731373634393133323139313738392c35303330303830303838303232373532303633373234373835323136343235343834313733323238383233343339353035363935373530333136363238323831343132303439303239343033345d7d2c7b22436f6f726473223a5b33323832313336373637393831383031363331303339333231333039313030353533383534343839383036353334343031303937373530373035303834323436383032393434393331323435352c32303834363631303036343334323138373533363333333432343135363632333739333930363030353235323138373939323535323631343937323036343937373338373434303335313633335d7d2c7b22436f6f726473223a5b33323336343532393334363836373233363834303533313434353734353837393834323235353739343231393738373434303032393734313533303130343736333132303739353731333532312c3130393931313734313337363236353032323734383436313132313738363739303934303435313735373438333831313438333536303431333633303434393932323434353234313035313633365d7d2c7b22436f6f726473223a5b32343031383039363734383439343731333134383935393634323234393133323635343630383134353330393933393332343335373936393432333933373635383931393336323137353536382c333233383136313534383530313839393238343934343932313636303436343930393331323331363833343831353438353536383631363933383035303037313436363436373330323730325d7d2c7b22436f6f726473223a5b32373135383234353834373031313033363434313831303333393735393231393932373835313432303537363834383739363735323030313234393430383631353039313236383437363936392c33323534343137393138393036373937323834323934303633303932333832323937313337363435353935353936353034313834393732343938323539323036373935343536353739373839365d7d2c7b22436f6f726473223a5b39323535323831323738393934333834333830313230323532303933303337363236333231363332343439313536343439323134333431333830343739323930353036323135383331323335322c39353138373634363636343138373038343239323137333434343633313636313635343337393130383039383134363035353933303030313836333433313635333732323739313636373333335d7d5d2c225061696c6c696572504b73223a5b7b224e223a32323830313335303038373335383239343837343731333037383830303937313936373735393038313734393130333436323333363436333932383533323836363035393632353632373932383235373332343337313331333538383632343532343835363233353333333331303934383933363931393438373337373435383732363838323639383030363233383633393135323331383530363737363730333938313838383336313839303538393033323732323639303436363331343437303238333439313633393035373237393231323439343835313638323632323437373333313433343634343335363337353237333133333639313432393230373038303035333436363236323633373336333735383635343733353339333939343830323136343738343639323235383239363831363837333332333934363031313835393631373336303035363932303137313039393436343335373532383338353434303231323533363933353135383330363639313532373236393437363631343233313835343839303332323737303833313336333932363330393035313435393635323533353031373133353938313837393331313136323837333237313237363731313038353434353732353134303639303133333434323639373135393938393436333139353030363731303838343839303634303330373232363533303536333031383534303236343233303832363238313033353232383332353039343333333631343733373130383236383034363933393035313037393931343739333931363533303433313731333436313432393135353931333439393132373439377d2c7b224e223a32303734303638343137323338383137303334383032303439303234303130323439323638303631333631343032313337333636373832363135303832343938363631353039363239353336333230303836373936313534313531323432373938303331303036393135333037313838383431373139363735333538333035353239373731363531323932333337393635363333303834383037313436393431303734353833343537393630303433323034393136393938333436303938383733313730333236363534383331303936333839303436303532393336323137383032353734383436323130313231313532333234323030313837363437333634343936373239303839303032363839373139363139303439363232303330313430363931373133383238393838363536343938313939363235323339313837303532353538363334343533373838343234333237383035353837333537343239353339363638343137383235303532353336393136383534343933333833313131363530323339393032313339313837363636383037303433373630353738393535383034333535353239363833303031313433303832373632363838313534373038393138393634363737303736393839353431353132303437363437353639373535373334363033303034323331343533313631323939333833303233323635363432343432363531383137393437313234353737393437373038333539333938363036383539353630373930373334353734373037323031353038303232333531313932343938343136373832393437313539383633303735383936393430393639323234397d2c7b224e223a32343533323438353430353932333031323137353931323236303532343130363137303438333235373937383633333233333231383735323432383939313232303937373936393138323037383933373434303634383237363933313036383533383834393139373638393036373636343435343334303534383032383836373931353536363035323739353733313839353132373932373036353636393532303333363136393732393238343734363033373539393236333133353933353332363637353931363730313333363639333835363438313438393838353639323337383839333739353230353532393738353133313838303734303539383333383834333835303438393932353832383839323534323631373833323933363437373938343032343330353135363531373830353331343837323935313638383835343832363830313035303535353938323330383334323735383138343630323434323731303534373432333439313037323837383138373932393231373837303737353135313830313230373030323630303232313332373133383633373536383930323733393631383738333535303431383436373639373837323931343634303933313930313933313136343730393131313035343434303535393232303432313939343236313131373836323038353337393138323833363639393339373635313731373235313933383539333730303937303739383730313431373335383030363338343936333738383436383437353837303831313933343031393339353931393133373732323633323133373433353039303236313537353633383936373230317d2c7b224e223a32303734353232373738373236323932323536353633333937363331383034373230373031333639373739393136343930393030313530363136363133383230333239333032303038323339363731373837373737313633323439323330303030323833333135373630383331383636383639333638383033313038303931363730393334343234373031343233363436303136383432333030373836333233393332303538373039303338343930383430393330393230373730383235393930333639373638323434313833373030373035353531373432363238393036393633313835363934313736303231353732343736363034313930313233333334383237343138363536313839373039373332383636313436373133363130343433353634313236323134393536313838323834313431383636303436353133383136393030363934333031303731383933323032383539393830353530343336363833363339363637393032323332373437393238303334373039383333313433373834353637393932303830323937363038383233373033353038343235303135383832323839373836303638373531393734353137383332323833353937333637343637313734393639323233373237383837333438303534393831373634363835393334363331313039373937393431303739323030353338343139373137303839313533383630343338323535383637333339333630353237343732383430323835393535393531393635323839313037383032303537303332393434333837323639363434313037343833313937323339323731343931383736313038303937373632397d2c7b224e223a32353535373231313331343838333039333036313633313933323138353736333332353730353331353334373936343935323039363939383435333439333632313235383534393934393030343232373139353337383639343238343332383739323736383932393433313334313638343733323931353831393333343034353431353736363636343631313535343032323634303537303739333639383230343038353337393938363138383033373732313539323837323333323732393236313638333836313639323238363831303231323835383236383436353433373939303434393233363539353835363837343634383137343639333838313137323234303936333631373230383831393534373036353931323530393634303131333030313331363034323435313331333530343139313236333237353032353334393238383237363730393731383431343335333632313837343335323236343235343034363235393030303133333339393232333535353732323133313838373237333333393532333831323239303233383134323233363036383937353638333738313930343334353236383834393435363231393430343231323834313135383533383535313132323630373631363838313530303135303330353937303734393138393134383231343930313530313737343039323037333931373831333034363036323336313635313937313934383431343936303336373337393130343835303637343835373131303435313431393139303136363036303133313335353937363239323437373830343936393830353030363836333932333439383637343639377d2c7b224e223a32353338383832363330343037353431383934313531333130363735353032393436333639313731373930343737333439313335313831363632323436333430363735373330383337383937383233363936363133313339353534363237303534363933383738353131333935353938383134383333303235353235323939323931323338353133323236333334323537333435353139313834333534353437373038333639333533323937313635373335353435333532313834333233333639303638363535383939383037383738393839323633323839313934373932303831313232333331303537333438353237343132313332343532353531353234313731393931353233373330373232323436333638393736323334393734313838323438353136363330353532373335323336313835353239393338363835383139323337383238343230303237323631323838333539333337393439333433373630343935363336313330363437393336373137373735343635393838343135333935363630383736363534343633373134373039363933373739353931373236383631363833363239323731363239373939393739313430303132353835323439333539313130383439373735313233373035373138303737313335373130303333383138333531393031323431373030333739343633343832353439303638333232343738343233323134323936343830353232363930393431383634353137363935333437333935383534333332373333343332363234353832333734313132333739373339323138373035353936343731383230393539393533333136363337313133337d5d2c2241757468656e7469636174696f6e504b73223a5b6e756c6c2c7b2258223a38393437323333303536373535343437373034363232353933313330373433333134323132363632363833333835363635303938383431313835383935313831333339313632303938323936302c2259223a38303334393131383835333736333835303632323234393830383932383535313638313630383132393139393030313931393631393831363230393935353835363538373536373139363536327d2c7b2258223a39373731393836363033343130373230373630333230343530373735313233353234313637343737313431333639333835343433323932323833323137373237353835333335343938323538382c2259223a39353935313138383633353232343838303631373035383836303032363038323033333038343235353530393735383833323332323232333239343730333032363836373730393136393834397d2c7b2258223a32343436333938383734343639373837303634303430363137343234383039353837363532373838333336333736323634303832313430373431343036303531333530353339333934363230332c2259223a363639333634323533383632383135393638323239313436363835333238313837393830323038333932353538353333373631373330353735333334353334313539323530383330343439307d2c7b2258223a36373935353835313231333737363331333539353737303831313631313632363033333930323239353131373233363633393136313031333332333830363738343938303535363135353137312c2259223a38343739393633383937373837323339373230343836343938303935313430363036343134303234323137313637393330353633373638353338303334373936363638313230323631313033317d2c7b2258223a34363636383239363430313732343230313630303733373733323730343939313837323735373930313234353638313135353139313632353935303033313430353531313138333336363731332c2259223a383736363131353639383331363135353637393137383734313131363739323034353032363335373631353633363535323031363832363830313438393238353130373339343637323232357d5d2c224543445341507562223a7b22436f6f726473223a5b35353635333538353035343133393835393530303538373934303035393236383130353232383939373232333537303537343236343037383834393732393838323835333031313230393936382c3131303835303236363130343137393238383338323833303338323133383533323434313133333432303630383135353037363430343038323130373730313136323434373939393638363537345d7d7d"
)
